<Layout>
	<div>
		{{#await item_promise}}
			<p>loading...</p>
		{{then item}}
			<article class='item'>
				<a class='main-link' href='{{item.url}}'>
					<h1>{{item.title}}</h1>
					{{#if item.url}}<small>{{item.domain}}</small>{{/if}}
				</a>

				<p class='meta'>{{item.points}} points by <a href='/user/{{item.user}}'>{{item.user}}</a> {{timebetween( item.time, now )}} ago</p>

				{{#if item.content}}
					{{{item.content}}}
				{{/if}}
			</article>

			<div class='comments'>
				{{#each item.comments as comment}}
					<Comment comment='{{comment}}'/>
				{{/each}}
			</div>
		{{catch error}}
			<p>something went wrong: {{err.message}}</p>
		{{/await}}
	</div>
</Layout>

<style>
	h3 {
		margin: 0 0 1em 0;
	}

	.item {
		border-bottom: 1em solid #f4f4f4;
		margin: 0 -2em 2em -2em;
		padding: 0 2em 2em 2em;
	}

	.main-link {
		display: block;
		text-decoration: none;
	}

	small {
		display: block;
		font-size: 14px;
	}

	.meta {
		font-size: 0.8em;
		color: #666;
	}
</style>

<script>
	import Layout from '../_components/Layout.html';
	import Comment from './Comment.html';
	import timebetween from '../_helpers/timebetween.js';

	export default {
		components: {
			Layout,
			Comment
		},

		helpers: {
			timebetween
		},

		computed: {
			item_promise: params => fetch(`https://node-hnapi.herokuapp.com/item/${params.id}`).then(r => r.json())
		}
	};
</script>